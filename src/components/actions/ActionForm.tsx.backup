import React, { useState } from "react";
import type { Product } from "../../types/product";
import type { ActionRequest, ActionType, AmountType } from "../../types/action";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from "@/components/ui/select";

interface ActionFormProps {
  products: Product[];
  onSubmit: (action: ActionRequest) => void;
  isSubmitting: boolean;
  initialData?: Partial<ActionRequest>;
}

const ActionForm: React.FC<ActionFormProps> = ({ products, onSubmit, isSubmitting, initialData }) => {
  const [formData, setFormData] = useState<ActionRequest>({
    type: "buy",
    amountType: "piece",
    amount: 0,
    ...initialData
  });

  
  const handleChange = (name: keyof ActionRequest, value: string | number | boolean) => {
    setFormData({
      ...formData,
      [name]: value,
    });
  };

  const handleTypeChange = (value: ActionType) => {
    setFormData({
      ...formData,
      type: value,
    });
 
  };

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    onSubmit(formData);
  };

  return (
    <form onSubmit={handleSubmit} className="space-y-6">
      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
        {/* Action Type Selection */}
        <div>
          <Label htmlFor="type">نوع الإجراء</Label>
          <Select 
            value={formData.type} 
            onValueChange={handleTypeChange}
          >
            <SelectTrigger>
              <SelectValue placeholder="اختر نوع الإجراء" />
            </SelectTrigger>
            <SelectContent>
              <SelectItem value="buy">شراء (Buy)</SelectItem>
              <SelectItem value="other">آخر (Other)</SelectItem>
            </SelectContent>
          </Select>
        </div>

        {/* Amount Type Selection */}
        <div>
          <Label htmlFor="amountType">نوع الكمية</Label>
          <Select 
            value={formData.amountType} 
            onValueChange={(value: AmountType) => handleChange("amountType", value)}
          >
            <SelectTrigger>
              <SelectValue placeholder="اختر نوع الكمية" />
            </SelectTrigger>
            <SelectContent>
              <SelectItem value="piece">قطعة</SelectItem>
              <SelectItem value="kg">كيلوغرام</SelectItem>
              <SelectItem value="litre">لتر</SelectItem>
            </SelectContent>
          </Select>
        </div>
      </div>

      {/* Product-related fields */}
     
      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <Label htmlFor="product">اختر المنتج</Label>
            <Select 
              value={formData.product || ""} 
              onValueChange={(value) => handleChange("product", value)}
            >
              <SelectTrigger>
                <SelectValue placeholder="اختر منتجًا" />
              </SelectTrigger>
              <SelectContent>
                {products?.map((product) => (
                  <SelectItem key={product._id} value={product._id}>
                    {product.name}
                  </SelectItem>
                ))}
              </SelectContent>
            </Select>
          </div>
          
          <div>
            <Label htmlFor="amount">الكمية</Label>
            <Input
              id="amount"
              type="number"
              min="0"
              value={formData.amount}
              onChange={(e) => handleChange("amount", Number(e.target.value))}
              required={true}
              placeholder="أدخل الكمية"
            />
          </div>
      </div>

      {/* Type Description */}
      <div>
        <Label htmlFor="typeDesc">وصف الإجراء (اختياري)</Label>
        <Input
          id="typeDesc"
          value={formData.typeDesc || ""}
          onChange={(e) => handleChange("typeDesc", e.target.value)}
          placeholder="وصف تفصيلي للإجراء"
        />
      </div>

      {/* Date */}
      <div>
        <Label htmlFor="date">التاريخ (اختياري)</Label>
        <Input
          id="date"
          type="date"
          value={formData.date || ""}
          onChange={(e) => handleChange("date", e.target.value)}
        />
      </div>

      {/* Financial Fields Toggle */}
      <div className="flex items-center justify-between bg-gray-50 p-3 rounded-lg">
        <div>
          <Label className="text-sm font-medium">إضافة معلومات مالية</Label>
          <p className="text-xs text-gray-600">وارد/منصرف/بيان</p>
        </div>
        <button
          type="button"
          onClick={toggleFinancialFields}
          className={`relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none ${
            showFinancialFields ? "bg-blue-600" : "bg-gray-300"
          }`}
        >
          <span
            className={`inline-block h-4 w-4 transform rounded-full bg-white transition-transform ${
              showFinancialFields ? "translate-x-6" : "translate-x-1"
            }`}
          />
        </button>
      </div>

      {/* Financial Fields */}
      {showFinancialFields && formData && (
        <div className="grid grid-cols-1 md:grid-cols-3 gap-4 p-4 bg-blue-50 rounded-lg">
          <div>
            <Label htmlFor="income">وارد</Label>
            <Input
              id="income"
              type="number"
              min="0"
              step="0.01"
              value={formData.income || ""}
              onChange={(e) => handleChange("income", Number(e.target.value))}
              placeholder="المبلغ الوارد"
            />
          </div>
          
          <div>
            <Label htmlFor="outcome">منصرف</Label>
            <Input
              id="outcome"
              type="number"
              min="0"
              step="0.01"
              value={formData.outcome || ""}
              onChange={(e) => handleChange("outcome", Number(e.target.value))}
              placeholder="المبلغ المنصرف"
            />
          </div>
          
          <div className="md:col-span-3">
            <Label htmlFor="desc">البيان</Label>
            <Input
              id="desc"
              value={formData.desc || ""}
              onChange={(e) => handleChange("desc", e.target.value)}
              placeholder="وصف العملية المالية"
            />
          </div>
        </div>
      )}
      
      <div className="flex justify-end pt-4">
        <Button type="submit" disabled={isSubmitting}>
          {isSubmitting ? "جاري المعالجة..." : "إرسال الإجراء"}
        </Button>
      </div>
    </form>
  );
};

export default ActionForm;

